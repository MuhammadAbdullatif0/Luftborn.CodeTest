<div class="page">
  <div class="page__header">
    <h1 class="page__title">Categories</h1>
    <button type="button" class="btn btn--primary" (click)="openCreate()">
      <span class="btn__icon">+</span>
      Add Category
    </button>
  </div>

  @if (error()) {
    <div class="alert alert--error">
      {{ error() }}
      <button type="button" class="alert__dismiss" (click)="error.set(null)">√ó</button>
    </div>
  }

  @if (loading()) {
    <div class="loading">
      <div class="loading__spinner"></div>
      <p>Loading...</p>
    </div>
  } @else if (categories().length === 0) {
    <div class="empty">
      <span class="empty__icon">üìÅ</span>
      <h2>No categories yet</h2>
      <p>Create your first category to get started</p>
      <button type="button" class="btn btn--primary" (click)="openCreate()">Add Category</button>
    </div>
  } @else {
    <div class="grid">
      @for (cat of categories(); track cat.id) {
        <div class="card">
          <div class="card__body">
            <h3 class="card__title">{{ cat.name }}</h3>
          </div>
          <div class="card__actions">
            <button type="button" class="btn btn--ghost" (click)="openEdit(cat)">Edit</button>
            @if (deleteConfirmId() === cat.id) {
              <div class="confirm">
                <span>Delete?</span>
                <button type="button" class="btn btn--danger btn--sm" (click)="delete(cat.id)">Yes</button>
                <button type="button" class="btn btn--ghost btn--sm" (click)="cancelDelete()">No</button>
              </div>
            } @else {
              <button type="button" class="btn btn--ghost btn--danger" (click)="confirmDelete(cat.id)">Delete</button>
            }
          </div>
        </div>
      }
    </div>
  }
</div>

@if (modalOpen()) {
  <div class="modal-backdrop" (click)="closeModal()"></div>
  <div class="modal" role="dialog" (click)="$event.stopPropagation()">
    <div class="modal__header">
      <h2>{{ editingId() ? 'Edit Category' : 'New Category' }}</h2>
      <button type="button" class="modal__close" (click)="closeModal()" aria-label="Close">√ó</button>
    </div>
    <div class="modal__body">
      <div class="field">
        <label for="cat-name">Name</label>
        <input id="cat-name" type="text" [(ngModel)]="formName" placeholder="Category name" class="input" (keyup.enter)="save()" />
      </div>
    </div>
    <div class="modal__footer">
      <button type="button" class="btn btn--ghost" (click)="closeModal()">Cancel</button>
      <button type="button" class="btn btn--primary" (click)="save()" [disabled]="formSaving() || !formName.trim()">
        {{ formSaving() ? 'Saving...' : 'Save' }}
      </button>
    </div>
  </div>
}
